<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²éšæ¯”ç†±å¯¦é©—ï¼šç”˜æ²¹æ¸¬é‡ - æ•¸æ“šè¿½è¹¤ç‰ˆ</title>
    
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¼‰å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- è¼‰å…¥ PropTypes (Recharts çš„å¿…è¦ä¾è³´ï¼Œä¿®å¾© oneOfType éŒ¯èª¤) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- è¼‰å…¥ Recharts (åœ–è¡¨åº«) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.0/Recharts.min.js"></script>
    
    <!-- è¼‰å…¥ Babel (ç”¨æ–¼è§£æ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* é¿å…æ²è»¸åœ¨åµŒå…¥æ™‚é€ æˆé›™é‡æ²å‹• */
        body { margin: 0; padding: 0; overflow: hidden; }
        #root { height: 100vh; width: 100vw; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 1. Interaction Logger (æ•¸æ“šè¿½è¹¤å·¥å…·)
        // ==========================================
        const STORAGE_KEY = "TaskInteractionData";
        let interactionHistory = [];

        const InteractionLogger = {
            init: function() {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    try {
                        const parsed = JSON.parse(stored);
                        if (Array.isArray(parsed)) {
                            interactionHistory = parsed;
                        }
                    } catch (e) {
                        console.warn("Failed to parse existing interaction data", e);
                        interactionHistory = [];
                    }
                }
                this.log('Initialize', { timestamp: new Date().toISOString(), sim: "SpecificHeat_Advanced_React" });
            },

            log: function(action, details = {}) {
                const event = {
                    timestamp: new Date().toISOString(),
                    action: action,
                    details: details
                };
                interactionHistory.push(event);
                // é™åˆ¶é•·åº¦
                if (interactionHistory.length > 500) {
                    interactionHistory.shift();
                }
                localStorage.setItem(STORAGE_KEY, JSON.stringify(interactionHistory));
                // console.log(`[Logged]: ${action}`, details); 
            },

            clear: function() {
                interactionHistory = [];
                localStorage.setItem(STORAGE_KEY, JSON.stringify([]));
            }
        };


        // ==========================================
        // 2. React æ‡‰ç”¨ç¨‹å¼
        // ==========================================
        
        // è§£æ§‹ React Hooks
        const { useState, useEffect, useRef, useMemo } = React;
        
        // ç¢ºä¿ Recharts å·²æ­£ç¢ºè¼‰å…¥
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts || {};

        // --- å…§å»ºåœ–æ¨™å…ƒä»¶ (å–ä»£ lucide-react ä¾è³´ä»¥ä¿®å¾©éŒ¯èª¤) ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3" /></IconBase>;
        const Pause = (props) => <IconBase {...props}><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></IconBase>;
        const Flame = (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" /></IconBase>;
        const Calculator = (props) => <IconBase {...props}><rect x="4" y="2" width="16" height="20" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconBase>;
        const TrendingUp = (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></IconBase>;
        const FlaskConical = (props) => <IconBase {...props}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2" /><path d="M8.5 2h7" /><path d="M7 16h10" /></IconBase>;

        const SpecificHeatLabAdvanced = () => {
            // --- ç‹€æ…‹ç®¡ç† ---
            const [isRunning, setIsRunning] = useState(false);
            const [time, setTime] = useState(0); // ç§’
            const [temperature, setTemperature] = useState(25.0); // æ”æ°
            const [mass, setMass] = useState(200); // æ¶²é«”è³ªé‡ (g)
            const [hasLid, setHasLid] = useState(false); // æ˜¯å¦åŠ è“‹
            const [liquidType, setLiquidType] = useState('water'); // 'water' æˆ– 'glycerin'
            const [recordedData, setRecordedData] = useState([]); // ç´€éŒ„çš„æ•¸æ“šé»
            const [showFit, setShowFit] = useState(false); // é¡¯ç¤ºæ“¬åˆç·š

            // 1. åˆå§‹åŒ– Logger (ä½¿ç”¨ useEffect æ¨¡æ“¬ componentDidMount)
            useEffect(() => {
                InteractionLogger.init();
            }, []);

            // --- ç‰©ç†å¸¸æ•¸ ---
            const SPECIFIC_HEAT_WATER = 1.0; // cal/gÂ°C
            const SPECIFIC_HEAT_GLYCERIN = 0.58; // cal/gÂ°C (ç”˜æ²¹æ¯”ç†±)
            
            // å…§éƒ¨è¨­å®šç«æºåŠŸç‡ (æœªçŸ¥æ•¸ X)
            const INPUT_POWER = 30.0; // cal/s
            
            const AMBIENT_TEMP = 25.0; // ç’°å¢ƒæº«åº¦
            const DT = 0.1; // æ¨¡æ“¬æ™‚é–“æ­¥é•· (ç§’)

            // --- æ•£ç†±ä¿‚æ•¸ ---
            const COEFF_CONVECTION = 0.04; // cal/s/Â°C
            // ç”˜æ²¹è¼ƒé»ç¨ ä¸”æ²¸é»é«˜ï¼Œè’¸ç™¼æ•ˆæ‡‰æ¯”æ°´ä½å¾ˆå¤šï¼Œé€™è£¡è¨­å®šå…¶è’¸ç™¼ä¿‚æ•¸è¼ƒå°
            const COEFF_EVAPORATION_WATER = 0.5; 
            const COEFF_EVAPORATION_GLYCERIN = 0.1; 

            const requestRef = useRef();

            // --- ç‰©ç†æ¨¡æ“¬æ ¸å¿ƒ Loop ---
            const animate = () => {
                if (isRunning) {
                setTemperature((prevTemp) => {
                    // 0. å–å¾—ç•¶å‰æ¶²é«”ç‰©ç†æ€§è³ª
                    const currentS = liquidType === 'water' ? SPECIFIC_HEAT_WATER : SPECIFIC_HEAT_GLYCERIN;
                    const currentEvapCoeff = liquidType === 'water' ? COEFF_EVAPORATION_WATER : COEFF_EVAPORATION_GLYCERIN;
                    
                    // 1. è¨ˆç®—æ•£ç†±
                    const deltaT = prevTemp - AMBIENT_TEMP;
                    if (deltaT < 0) return AMBIENT_TEMP;

                    const p_convection = COEFF_CONVECTION * deltaT;
                    const lidFactor = hasLid ? 0.05 : 1.0; 
                    
                    // è’¸ç™¼æ¨¡å‹ (ç°¡æ˜“)
                    const p_evaporation = lidFactor * currentEvapCoeff * (Math.exp(0.055 * prevTemp) - Math.exp(0.055 * AMBIENT_TEMP));
                    
                    const p_total_loss = p_convection + p_evaporation;

                    // 2. è¨ˆç®—æ·¨åŠŸç‡èˆ‡æº«å‡
                    const p_net = INPUT_POWER - p_total_loss;
                    const dT = (p_net * DT) / (mass * currentS);

                    let nextTemp = prevTemp + dT;

                    // 3. æ²¸é»é™åˆ¶ (æ°´=100ï¼Œç”˜æ²¹=290ä½†é€™è£¡ä¸é™åˆ¶å› ç‚ºå¾ˆé›£ç‡’åˆ°)
                    if (liquidType === 'water' && nextTemp >= 100) {
                        nextTemp = 100;
                    }
                    
                    return nextTemp;
                });

                setTime((prevTime) => prevTime + DT);
                requestRef.current = requestAnimationFrame(animate);
                }
            };

            useEffect(() => {
                if (isRunning) {
                requestRef.current = requestAnimationFrame(animate);
                } else {
                cancelAnimationFrame(requestRef.current);
                }
                return () => cancelAnimationFrame(requestRef.current);
            }, [isRunning, mass, hasLid, liquidType]);

            // --- è¼”åŠ©åŠŸèƒ½ & äº’å‹•è¿½è¹¤ ---
            
            const handleStart = () => {
                setIsRunning(true);
                InteractionLogger.log('ToggleHeating', { status: 'On' });
            };

            const handleStop = () => {
                setIsRunning(false);
                InteractionLogger.log('ToggleHeating', { status: 'Off' });
            };

            const handleReset = () => {
                setIsRunning(false);
                setTime(0);
                setTemperature(25.0);
                setRecordedData([]);
                setShowFit(false);
                InteractionLogger.log('ResetExperiment');
            };

            // åˆ‡æ›æ¶²é«”æ™‚é‡ç½®
            const handleLiquidChange = (type) => {
                setLiquidType(type);
                handleReset();
                InteractionLogger.log('ChangeLiquid', { type: type });
            };

            const handleRecord = () => {
                setRecordedData([
                ...recordedData,
                { 
                    id: Date.now(),
                    time: parseFloat(time.toFixed(1)), 
                    temp: parseFloat(temperature.toFixed(2)) 
                }
                ]);
                InteractionLogger.log('RecordData', { 
                    time: parseFloat(time.toFixed(1)), 
                    temp: parseFloat(temperature.toFixed(2)),
                    liquid: liquidType
                });
            };

            const toggleLid = () => {
                const newState = !hasLid;
                setHasLid(newState);
                InteractionLogger.log('ToggleLid', { hasLid: newState });
            };

            const toggleFit = () => {
                const newState = !showFit;
                setShowFit(newState);
                InteractionLogger.log('ToggleFit', { visible: newState });
            };

            // æ»‘æ¡¿å°ˆç”¨çš„ Log å‡½æ•¸ (åœ¨ onMouseUp / onTouchEnd è§¸ç™¼ï¼Œé¿å…æ•¸æ“šéå¤š)
            const logMassChange = () => {
                InteractionLogger.log('ChangeMass', { value: mass });
            };

            // --- ç·šæ€§å›æ­¸è¨ˆç®— ---
            const linearFit = useMemo(() => {
                if (recordedData.length < 2) return null;

                const n = recordedData.length;
                let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;

                recordedData.forEach(p => {
                sumX += p.time;
                sumY += p.temp;
                sumXY += p.time * p.temp;
                sumXX += p.time * p.time;
                });

                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                const minTime = recordedData[0].time;
                const maxTime = recordedData[n - 1].time;

                return {
                slope: slope,
                intercept: intercept,
                points: [
                    { time: minTime, fitTemp: slope * minTime + intercept },
                    { time: maxTime, fitTemp: slope * maxTime + intercept }
                ]
                };
            }, [recordedData]);

            // --- è¦–è¦ºåƒæ•¸ ---
            const waterHeight = Math.min(185, (mass / 500) * 150 + 30);
            // é¡è‰²åˆ‡æ›ï¼šæ°´(è—è‰²), ç”˜æ²¹(æ·¡é»ƒè‰²é»ç¨ æ„Ÿ)
            const fluidColor = liquidType === 'water' 
                ? `rgba(${Math.min(255, 100 + (temperature - 25) * 2)}, 149, 237, 0.6)`
                : `rgba(255, 240, 150, 0.7)`; // ç”˜æ²¹é¡è‰²

            if (!LineChart) {
                return <div className="flex items-center justify-center h-screen text-red-600 font-bold">Error: åœ–è¡¨åº« (Recharts) è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚</div>;
            }

            return (
                <div className="flex flex-col h-screen bg-gray-50 text-gray-800 font-sans overflow-hidden">
                {/* æ¨™é¡Œåˆ— */}
                <header className="bg-emerald-700 text-white p-4 shadow-md flex justify-between items-center z-10 shrink-0">
                    <div className="flex items-center gap-2">
                    <FlaskConical className="w-6 h-6 text-yellow-300" />
                    <h1 className="text-xl font-bold tracking-wide">é€²éšå¯¦é©—ï¼šæ¸¬é‡æœªçŸ¥æ¶²é«”(ç”˜æ²¹)æ¯”ç†±</h1>
                    </div>
                    <div className="text-sm bg-emerald-800 px-3 py-1 rounded-full border border-emerald-500">
                    ç«æºåŠŸç‡: <span className="font-mono font-bold text-yellow-300 text-lg">X</span> cal/s (æœªçŸ¥)
                    </div>
                </header>

                <main className="flex flex-1 overflow-hidden">
                    {/* å·¦å´ï¼šæ¨¡æ“¬å€èˆ‡æ§åˆ¶å€ */}
                    <div className="w-1/2 flex flex-col border-r border-gray-200 bg-white p-4 overflow-y-auto">
                    
                    {/* 1. è¦–è¦ºæ¨¡æ“¬å ´æ™¯ */}
                    <div className="relative h-96 bg-gray-100 rounded-xl border border-gray-300 mb-4 flex justify-center items-end pb-2 shadow-inner overflow-hidden">
                        
                        {/* æ¨™ç±¤ï¼šé¡¯ç¤ºç›®å‰æ¶²é«” */}
                        <div className="absolute top-4 left-4 z-20 bg-white/80 backdrop-blur px-3 py-1 rounded border border-gray-300 shadow-sm text-sm font-bold text-gray-700">
                            ç•¶å‰æ¶²é«”: {liquidType === 'water' ? 'ğŸ’§ æ°´ (Water)' : 'ğŸ§ª ç”˜æ²¹ (Glycerin)'}
                        </div>

                        {/* è£ç½®ç¾¤çµ„ */}
                        <div className="flex flex-col items-center mb-4">
                        
                        {/* === ç‡’æ¯æ¨¡çµ„ === */}
                        <div className="relative w-32 h-48 mb-1">
                            
                            {/* æº«åº¦è¨ˆ */}
                            <div 
                            className="absolute left-1/2 -translate-x-1/2 z-30 flex flex-col items-center" 
                            style={{ 
                                bottom: '20px', 
                                height: '240px' 
                            }}
                            >
                            <div className="w-2 flex-1 bg-yellow-50 border border-gray-400 rounded-t-lg relative shadow-sm">
                                <div 
                                className="absolute bottom-0 w-full bg-red-500 transition-all duration-100 ease-linear rounded-b-sm"
                                style={{ height: `${Math.max(5, (temperature / 120) * 100)}%` }}
                                ></div>
                                {[10, 20, 30, 40, 50, 60, 70, 80, 90, 100].map((pos) => (
                                <div key={pos} className="absolute right-0 w-1 h-[1px] bg-black/30" style={{ bottom: `${pos}%` }}></div> 
                                ))}
                            </div>
                            <div className="w-4 h-4 rounded-full bg-red-600 -mt-1 border border-gray-400 shadow-sm relative z-30"></div>
                            
                            <div className="absolute -right-20 top-2 bg-black/80 text-white text-[10px] px-2 py-0.5 rounded font-mono">
                                T = {temperature.toFixed(1)}Â°C
                            </div>
                            </div>

                            {/* è“‹å­ */}
                            {hasLid && (
                            <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-[136px] h-4 bg-gray-500 rounded-sm z-20 shadow-md border border-gray-600 flex justify-center items-center">
                                <div className="w-8 h-1 bg-gray-700 rounded-full opacity-50"></div>
                            </div>
                            )}

                            {/* ç‡’æ¯æœ¬é«” */}
                            <div className="w-full h-full border-x-2 border-b-2 border-gray-400 rounded-b-xl relative bg-white/30 backdrop-blur-[1px] overflow-hidden z-10">
                            {/* æ¶²é«” */}
                            <div 
                                className="absolute bottom-0 w-full transition-all duration-500"
                                style={{ 
                                height: `${waterHeight}px`, 
                                backgroundColor: fluidColor 
                                }}
                            >
                                {/* æ²¸é¨°æ°£æ³¡ (åƒ…æ°´åœ¨100åº¦æ™‚ç™¼ç”Ÿ) */}
                                {liquidType === 'water' && temperature >= 100 && isRunning && (
                                <div className="w-full h-full relative overflow-hidden opacity-70">
                                    <div className="absolute bottom-2 left-4 w-2 h-2 bg-white rounded-full animate-ping"></div>
                                    <div className="absolute bottom-6 right-8 w-2 h-2 bg-white rounded-full animate-bounce"></div>
                                    <div className="absolute bottom-10 left-10 w-3 h-3 bg-white/50 rounded-full animate-pulse"></div>
                                </div>
                                )}
                            </div>

                            {/* åˆ»åº¦ */}
                            <div className="absolute right-0 bottom-10 w-3 h-[1px] bg-gray-600"></div>
                            <div className="absolute right-0 bottom-24 w-4 h-[1px] bg-gray-600"></div>
                            <div className="absolute right-0 bottom-38 w-3 h-[1px] bg-gray-600"></div>
                            </div>

                            {/* è’¸æ°£ (æ°´ä¸”ç„¡è“‹æ™‚é¡¯ç¤º) */}
                            {liquidType === 'water' && !hasLid && temperature > 60 && isRunning && (
                            <div className="absolute -top-16 left-0 w-full flex justify-center opacity-40 pointer-events-none z-0">
                                <div className="w-2 h-12 bg-gray-400 rounded-full blur-lg animate-pulse" style={{ animationDuration: '1s' }}></div>
                            </div>
                            )}
                        </div>

                        {/* éµæ¶å°ç¶²å­ */}
                        <div className="w-40 h-1 bg-gray-700 mx-auto rounded-full z-0 shadow-sm"></div>

                        {/* é…’ç²¾ç‡ˆ */}
                        <div className="flex flex-col items-center mt-12 relative">
                            <div className={`transition-opacity duration-300 absolute -top-12 left-1/2 -translate-x-1/2 ${isRunning ? 'opacity-100' : 'opacity-0'}`}>
                            <div className="relative">
                                <div className="w-5 h-12 bg-orange-500 rounded-full blur-[3px] animate-pulse absolute top-0 left-1/2 -translate-x-1/2"></div>
                                <div className="w-3 h-8 bg-yellow-200 rounded-full blur-[1px] absolute top-2 left-1/2 -translate-x-1/2"></div>
                            </div>
                            </div>
                            <div className="w-3 h-4 bg-yellow-900/90 rounded-sm -mt-2 relative z-10"></div>
                            <div className="w-20 h-14 bg-gray-200 border-2 border-gray-400 rounded-b-xl rounded-t-md shadow-sm relative overflow-hidden flex items-end justify-center z-10">
                                <div className="w-full h-10 bg-blue-300/40"></div>
                            </div>
                        </div>
                        </div>
                    </div>

                    {/* 2. æ§åˆ¶é¢æ¿ */}
                    <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-4 shrink-0">
                        
                        {/* æ¶²é«”èˆ‡è³ªé‡è¨­å®š */}
                        <div className="space-y-3">
                            {/* æ¶²é«”é¸æ“‡ */}
                            <div className="flex items-center gap-4 bg-gray-50 p-2 rounded border border-gray-200">
                                <span className="text-sm font-bold text-gray-700">é¸æ“‡æ¶²é«”:</span>
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input 
                                        type="radio" 
                                        name="liquid" 
                                        value="water" 
                                        checked={liquidType === 'water'}
                                        disabled={isRunning || recordedData.length > 0}
                                        onChange={() => handleLiquidChange('water')}
                                        className="text-blue-600 focus:ring-blue-500"
                                    />
                                    <span className="text-sm">æ°´ (Water)</span>
                                </label>
                                <label className="flex items-center gap-2 cursor-pointer">
                                    <input 
                                        type="radio" 
                                        name="liquid" 
                                        value="glycerin" 
                                        checked={liquidType === 'glycerin'}
                                        disabled={isRunning || recordedData.length > 0}
                                        onChange={() => handleLiquidChange('glycerin')}
                                        className="text-yellow-600 focus:ring-yellow-500"
                                    />
                                    <span className="text-sm">ç”˜æ²¹ (Glycerin)</span>
                                </label>
                            </div>

                            {/* è³ªé‡èˆ‡å™¨æ */}
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">æ¶²é«”è³ªé‡ (m)</label>
                                    <div className="flex items-center gap-2">
                                    <input 
                                        type="range" 
                                        min="100" 
                                        max="500" 
                                        step="50" 
                                        value={mass}
                                        disabled={isRunning || recordedData.length > 0}
                                        onChange={(e) => setMass(Number(e.target.value))}
                                        onMouseUp={logMassChange} // æ”¾é–‹æ»‘é¼ æ‰è¨˜éŒ„
                                        onTouchEnd={logMassChange} // æ‰‹æ©Ÿç«¯æ”¾é–‹æ‰è¨˜éŒ„
                                        className="w-full cursor-pointer accent-emerald-600"
                                    />
                                    <span className="text-sm font-mono bg-emerald-50 text-emerald-800 px-2 py-1 rounded font-bold">{mass} g</span>
                                    </div>
                                </div>
                                
                                <div className="flex items-center justify-end">
                                    <button 
                                    onClick={toggleLid}
                                    disabled={isRunning || recordedData.length > 0}
                                    className={`px-4 py-2 rounded-lg text-sm font-bold transition-all shadow-sm w-full ${
                                        hasLid 
                                        ? 'bg-gray-700 text-white ring-2 ring-gray-400 ring-offset-1' 
                                        : 'bg-white text-gray-500 border border-gray-300 hover:bg-gray-100'
                                    }`}
                                    >
                                    {hasLid ? 'å·²åŠ è“‹ (Lid ON)' : 'ç„¡è“‹å­ (Lid OFF)'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* æ“ä½œæŒ‰éˆ• */}
                        <div className="flex gap-2 pt-2 border-t">
                        {!isRunning ? (
                            <button 
                            onClick={handleStart}
                            className="flex-1 flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white py-2.5 rounded-lg font-bold shadow active:translate-y-0.5 transition-all"
                            >
                            <Play className="w-5 h-5 fill-current" /> é»ç«åŠ ç†±
                            </button>
                        ) : (
                            <button 
                            onClick={handleStop}
                            className="flex-1 flex items-center justify-center gap-2 bg-orange-500 hover:bg-orange-600 text-white py-2.5 rounded-lg font-bold shadow active:translate-y-0.5 transition-all"
                            >
                            <Pause className="w-5 h-5 fill-current" /> æš«åœå¯¦é©—
                            </button>
                        )}
                        
                        <button 
                            onClick={handleRecord}
                            disabled={!isRunning && time === 0}
                            className="flex-1 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-bold shadow active:translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <Save className="w-5 h-5" /> ç´€éŒ„æ•¸æ“š
                        </button>

                        <button 
                            onClick={handleReset}
                            className="flex items-center justify-center px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-bold transition-colors"
                            title="é‡ç½®å¯¦é©—"
                        >
                            <RotateCcw className="w-5 h-5" />
                        </button>
                        </div>
                        
                        {/* ç•¶å‰ç‹€æ…‹ */}
                        <div className="grid grid-cols-2 gap-4 text-center bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div>
                            <div className="text-xs text-gray-500 uppercase tracking-wider">åŠ ç†±æ™‚é–“ (t)</div>
                            <div className="text-2xl font-mono font-bold text-gray-800">{time.toFixed(1)} <span className="text-sm text-gray-500 font-normal">s</span></div>
                        </div>
                        <div>
                            <div className="text-xs text-gray-500 uppercase tracking-wider">ç•¶å‰æº«åº¦ (T)</div>
                            <div className="text-2xl font-mono font-bold text-red-600">{temperature.toFixed(2)} <span className="text-sm text-gray-500 font-normal">Â°C</span></div>
                        </div>
                        </div>

                    </div>
                    </div>

                    {/* å³å´ï¼šæ•¸æ“šèˆ‡åœ–è¡¨å€ */}
                    <div className="w-1/2 flex flex-col p-4 bg-gray-50 overflow-y-auto">
                    
                    {/* 1. åœ–è¡¨å€ */}
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-4 flex-none h-[400px] relative">
                        <div className="flex justify-between items-center mb-2">
                        <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                            <TrendingUp className="w-5 h-5 text-emerald-600" />
                            {liquidType === 'water' ? 'æ°´' : 'ç”˜æ²¹'}ï¼šæº«åº¦-æ™‚é–“ é—œä¿‚åœ–
                        </h2>
                        <button 
                            onClick={toggleFit}
                            disabled={recordedData.length < 2}
                            className={`text-xs px-3 py-1.5 rounded-full border flex items-center gap-1 transition-all font-medium ${
                            showFit 
                            ? 'bg-purple-100 text-purple-700 border-purple-300' 
                            : 'bg-white text-gray-500 border-gray-300 hover:bg-gray-50'
                            } disabled:opacity-30`}
                        >
                            <Calculator className="w-3 h-3" />
                            {showFit ? 'éš±è—æ“¬åˆç·š' : 'é¡¯ç¤ºç·šæ€§æ“¬åˆ'}
                        </button>
                        </div>

                        <ResponsiveContainer width="100%" height="90%">
                        <LineChart margin={{ top: 10, right: 30, left: 10, bottom: 20 }}>
                            <CartesianGrid strokeDasharray="3 3" opacity={0.3} />
                            <XAxis 
                            dataKey="time" 
                            type="number" 
                            domain={[0, 'auto']} 
                            label={{ value: 'æ™‚é–“ t (s)', position: 'bottom', offset: 0 }} 
                            />
                            <YAxis 
                            domain={[20, 'auto']} 
                            label={{ value: 'æº«åº¦ T (Â°C)', angle: -90, position: 'insideLeft' }} 
                            />
                            <Tooltip 
                            contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                            formatter={(value) => `${value} Â°C`}
                            labelFormatter={(label) => `${label} s`}
                            />
                            <Legend verticalAlign="top" height={36}/>
                            
                            <Line 
                            data={recordedData} 
                            type="monotone" 
                            dataKey="temp" 
                            name={liquidType === 'water' ? 'æ°´ (å¯¦æ¸¬)' : 'ç”˜æ²¹ (å¯¦æ¸¬)'}
                            stroke={liquidType === 'water' ? '#2563eb' : '#d97706'} 
                            strokeWidth={2}
                            dot={{ r: 4, fill: liquidType === 'water' ? '#2563eb' : '#d97706', strokeWidth: 2, stroke: "#fff" }}
                            activeDot={{ r: 6 }}
                            isAnimationActive={false}
                            />

                            {showFit && linearFit && (
                            <Line
                                data={linearFit.points}
                                dataKey="fitTemp"
                                name="ç·šæ€§æ“¬åˆ"
                                stroke="#9333ea"
                                strokeWidth={2}
                                strokeDasharray="5 5"
                                dot={false}
                                isAnimationActive={false}
                            />
                            )}
                        </LineChart>
                        </ResponsiveContainer>
                        
                        {/* æ“¬åˆçµæœæµ®å±¤ */}
                        {showFit && linearFit && (
                        <div className="absolute top-14 right-14 bg-white/95 backdrop-blur border border-purple-300 p-4 rounded-lg shadow-xl text-purple-900 z-10 w-64">
                            <p className="font-bold border-b border-purple-200 pb-2 mb-2 text-base">æ•¸æ“šåˆ†æ</p>
                            <div className="space-y-1 text-sm">
                            <p className="flex justify-between">
                                <span>æ–œç‡ (Slope):</span>
                                <span className="font-mono font-bold">{linearFit.slope.toFixed(4)}</span>
                            </p>
                            </div>
                        </div>
                        )}
                    </div>

                    {/* 2. æ•¸æ“šç´€éŒ„è¡¨ */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex-1 flex flex-col min-h-0">
                        <div className="p-3 bg-gray-50 border-b border-gray-200 font-bold text-gray-700 flex justify-between items-center shrink-0">
                        <span>æ•¸æ“šç´€éŒ„è¡¨ ({liquidType === 'water' ? 'æ°´' : 'ç”˜æ²¹'})</span>
                        <span className="text-xs font-normal text-gray-500 flex items-center gap-1">
                            <Info className="w-3 h-3"/> 
                            åˆ‡æ›æ¶²é«”æœƒæ¸…ç©ºè¡¨æ ¼
                        </span>
                        </div>
                        <div className="overflow-auto flex-1">
                        <table className="w-full text-sm text-left">
                            <thead className="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0 shadow-sm z-10">
                            <tr>
                                <th className="px-4 py-3">#</th>
                                <th className="px-4 py-3">æ™‚é–“ (s)</th>
                                <th className="px-4 py-3">æº«åº¦ (Â°C)</th>
                                <th className="px-4 py-3 text-right">å‡æº« Î”T</th>
                            </tr>
                            </thead>
                            <tbody>
                            {recordedData.length === 0 ? (
                                <tr>
                                <td colSpan="4" className="text-center py-10 text-gray-400 italic">
                                    å°šæœªè¨˜éŒ„æ•¸æ“š...
                                </td>
                                </tr>
                            ) : (
                                recordedData.map((row, index) => (
                                <tr key={row.id} className="bg-white border-b hover:bg-gray-50 transition-colors">
                                    <td className="px-4 py-2 font-medium text-gray-500">{index + 1}</td>
                                    <td className="px-4 py-2 font-mono">{row.time.toFixed(1)}</td>
                                    <td className="px-4 py-2 font-mono font-bold text-gray-800">{row.temp.toFixed(2)}</td>
                                    <td className="px-4 py-2 font-mono text-right text-gray-500">
                                    {(row.temp - 25).toFixed(2)}
                                    </td>
                                </tr>
                                ))
                            )}
                            </tbody>
                        </table>
                        </div>
                    </div>

                    </div>
                </main>
                </div>
            );
        };

        // æ¸²æŸ“å…ƒä»¶åˆ° DOM
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpecificHeatLabAdvanced />);
    </script>
</body>
</html>
